

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>How to perform calculations accurately &mdash; Fast F1 2.1.6 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/plot_directive.css" type="text/css" />
  <link rel="stylesheet" href="_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="_static/gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="_static/gallery-rendered-html.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Known bugs and caveats" href="known_bugs.html" />
    <link rel="prev" title="Time, Date and Timing - Explanation" href="time_explanation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Fast F1
          

          
          </a>

          
            
            
              <div class="version">
                2.1.6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/theOehrly/Fast-F1">← Back to Github</a></li>
</ul>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="examples/index.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="examples/basics.html">Getting started with the basics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="examples/basics.html#loading-a-session">Loading a session</a></li>
<li class="toctree-l3"><a class="reference internal" href="examples/basics.html#loading-a-session-by-name">Loading a session by name</a></li>
<li class="toctree-l3"><a class="reference internal" href="examples/basics.html#working-with-laps-and-lap-times">Working with laps and lap times</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="examples/index.html#example-plot">Example Plot</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples_gallery/index.html">Examples Gallery</a><ul>
<li class="toctree-l2"><a class="reference internal" href="examples_gallery/plot_gear_shifts_on_track.html">Gear shifts on track</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="fastf1.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fastf1</span></code> - Package functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="core.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fastf1.core</span></code> - Core module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="core.html#data-objects">Data Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="core.html#functions">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="core.html#api-reference">API Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="core.html#id1">Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="core.html#get-session">get_session</a></li>
<li class="toctree-l4"><a class="reference internal" href="core.html#get-round">get_round</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="core.html#id2">Data Objects</a><ul>
<li class="toctree-l4"><a class="reference internal" href="core.html#weekend">Weekend</a></li>
<li class="toctree-l4"><a class="reference internal" href="core.html#session">Session</a></li>
<li class="toctree-l4"><a class="reference internal" href="core.html#laps">Laps</a></li>
<li class="toctree-l4"><a class="reference internal" href="core.html#lap">Lap</a></li>
<li class="toctree-l4"><a class="reference internal" href="core.html#telemetry">Telemetry</a></li>
<li class="toctree-l4"><a class="reference internal" href="core.html#driver">Driver</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="core.html#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fastf1.api</span></code> - Api module</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fastf1.utils</span></code> - Utils module</a></li>
<li class="toctree-l1"><a class="reference internal" href="plotting.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fastf1.plotting</span></code> - Plotting module</a></li>
<li class="toctree-l1"><a class="reference internal" href="livetiming.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fastf1.livetiming</span></code> - Live Timing Client</a><ul>
<li class="toctree-l2"><a class="reference internal" href="livetiming.html#usage-example">Usage Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="livetiming.html#important-notes">Important Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="livetiming.html#command-line-interface">Command Line Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="livetiming.html#save">Save</a></li>
<li class="toctree-l3"><a class="reference internal" href="livetiming.html#extract">Extract</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="livetiming.html#module-fastf1.livetiming.client">Live Timing Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="livetiming.html#module-fastf1.livetiming.data">Live Timing Data Object</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="legacy.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fastf1.legacy</span></code> - Provides access to legacy functionality</a></li>
</ul>
<p class="caption"><span class="caption-text">Information:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="time_explanation.html">Time, Date and Timing - Explanation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="time_explanation.html#points-in-time">Points in Time</a></li>
<li class="toctree-l2"><a class="reference internal" href="time_explanation.html#lap-timing">Lap timing</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to perform calculations accurately</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#validating-results">Validating results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#working-with-the-available-data">Working with the available data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#slicing-data-by-lap-for-use-in-further-calculations">Slicing data by lap for use in further calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#disclaimer">Disclaimer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="known_bugs.html">Known bugs and caveats</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#something-doesn-t-work">Something doesn’t work</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v2-1-6-added-weather-data-general-improvements-and-bug-fixes">v2.1.6 Added weather data, general improvements and bug fixes</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v2-1-5-improved-robustness-and-minor-fixes">v2.1.5 Improved robustness and minor fixes</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v2-1-4-bug-fixes-and-various-minor-improvements">v2.1.4 Bug fixes and various minor improvements</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v2-1-3-improved-error-handling">v2.1.3 Improved error handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v2-1-2-hotfixes-for-loading-live-timing-data">v2.1.2 Hotfixes for loading live timing data</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v2-1-1-add-support-for-recording-and-using-live-timing-data">v2.1.1 Add support for recording and using live timing data</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v2-1-refactoring-accuracy-improvements-and-a-more-accessible-interface">v2.1: Refactoring, accuracy improvements and a more accessible interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v2-0-2-api-code-overhaul">v2.0.2: API code overhaul</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v2-0-1-integration-of-a-newer-version-of-ax6-s-old-repository">v2.0.1: Integration of a newer version of Ax6’s old repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v2-0-0-first-release-of-this-fork">v2.0.0: first release of this fork</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#v1-5-1-last-release-by-ax6">v1.5.1: last release by Ax6</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Fast F1</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>How to perform calculations accurately</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/howto_accurate_calculations.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="how-to-perform-calculations-accurately">
<h1>How to perform calculations accurately<a class="headerlink" href="#how-to-perform-calculations-accurately" title="Permalink to this headline">¶</a></h1>
<p>This is intended to be a writeup of my experiences. I discovered all of this when trying to implement new functionality
or when trying to improve existing calculations. The data that can be received from the F1 API has a very limited
sample rate of about 4-5 Hz. Furthermore, the data is somewhat jittery. That said, one can still perform accurate
calculations based on this data. But doing validation and accuracy checks is a must.</p>
<div class="section" id="validating-results">
<h2>Validating results<a class="headerlink" href="#validating-results" title="Permalink to this headline">¶</a></h2>
<p>It is extremely important to never assume that something is correct just because it looks right on the first glance.
Often it is possible to validate the data “against itself” or just validate it logically. This may not always give
absolute certainty that the results are accurate. But it can show when there are errors in the calculations. Or maybe
the data is simply not accurate enough for what one is trying to do.</p>
<p>Here are two examples for (partially) validating calculated data:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>Use a known accurate value as a comparison. Let’s assume we calculate the start time of each lap. As a result of</dt><dd><p>the calculations we get a timestamp per lap which marks the beginning of this lap. We can now subtract the
beginnings of two subsequent laps which will give us a measure for how long the first lap was, i.e. the lap
time. Lap timing is of course also measured separately and known to be accurate to one millisecond. And it
should be the same as our calculated values. This way we can validate the integrity of the calculated
timestamps, excluding any random errors or general inaccuracy. Of course, a fixed offset which is equal for all
timestamps would not show up as an error when using this validation.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Check that the data makes sense. Again, assume we are trying to find the start of a lap. If have calculated the</dt><dd><p>timestamps for that, we can also calculated the position of the car at this time. Every time a lap starts, the
car should be crossing over the finish line. And the finish line cannot physically move. So the position of the
car should be the same every time a new lap starts. If it isn’t there has to be an error somewhere.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="working-with-the-available-data">
<h2>Working with the available data<a class="headerlink" href="#working-with-the-available-data" title="Permalink to this headline">¶</a></h2>
<p>A few straight forward guidelines can be set.</p>
<blockquote>
<div><ul>
<li><dl>
<dt>Do not work with interpolated values. Interpolation does always introduce some inaccuracy and in my experience</dt><dd><p>this is rarely offset by more data points or by the fact that a timestamp matches better.</p>
<p>The API provides car data and position data separately and with two different time bases. If somehow possible,
you should use the data with the existing time base. That means, you cannot merge the datasets for use in
calculations as this requires interpolation. If you need a combined end result and/or a different time base,
do only merge and resample the result of your calculations. Do not resample the input data.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Do not perform calculations based on values that have been calculated by means of integration. The low sample rate</dt><dd><p>of the source data and the existing inaccuracies mean that integration will always be error prone. Errors can
stack up and single outliers will influence all further results of the integration.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>Clearly, this rules can not always be followed. They sometimes need to be broken as there may be no other way around it.
But, by keeping these rules in mind, potential error sources can be reduced.</p>
</div>
<div class="section" id="slicing-data-by-lap-for-use-in-further-calculations">
<h2>Slicing data by lap for use in further calculations<a class="headerlink" href="#slicing-data-by-lap-for-use-in-further-calculations" title="Permalink to this headline">¶</a></h2>
<p>If you simply wish to visualize existing data, slicing laps is rather straight forward.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">session</span> <span class="o">=</span> <span class="n">fastf1</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">)</span>
<span class="n">laps</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">load_laps</span><span class="p">(</span><span class="n">with_telemetry</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fastest_lap</span> <span class="o">=</span> <span class="n">laps</span><span class="o">.</span><span class="n">pick_fastest</span><span class="p">()</span>
<span class="n">tel</span> <span class="o">=</span> <span class="n">fastest_lap</span><span class="o">.</span><span class="n">telemetry</span>
</pre></div>
</div>
<p>This will give you the merged telemetry with a first and last value being interpolated additionally so as to exactly
match the start and end of the lap.
This data is not suitable for further calculations though.</p>
<p>If you want to perform your own calculations with the data, you should use the raw data.
To stay away from interpolation before doing any calculations, the following could be done:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">session</span> <span class="o">=</span> <span class="n">fastf1</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">)</span>
<span class="n">laps</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">load_laps</span><span class="p">(</span><span class="n">with_telemetry</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fastest_lap</span> <span class="o">=</span> <span class="n">laps</span><span class="o">.</span><span class="n">pick_fastest</span><span class="p">()</span>

<span class="c1"># use padding so that there are values outside of the desired range for accurate interpolation later</span>
<span class="n">car_data</span> <span class="o">=</span> <span class="n">fastest_lap</span><span class="o">.</span><span class="n">get_car_data</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pad_side</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
<span class="n">pos_data</span> <span class="o">=</span> <span class="n">fastest_lap</span><span class="o">.</span><span class="n">get_pos_data</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pad_side</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>

<span class="c1"># do calculations here</span>
<span class="c1"># ...</span>
<span class="c1"># ...</span>

<span class="n">merged_data</span> <span class="o">=</span> <span class="n">car_data</span><span class="o">.</span><span class="n">merge_channels</span><span class="p">(</span><span class="n">pos_data</span><span class="p">)</span>

<span class="c1"># slice again to remove the padding and interpolate the exact first and last value</span>
<span class="n">merged_data</span> <span class="o">=</span> <span class="n">merged_data</span><span class="o">.</span><span class="n">slice_by_lap</span><span class="p">(</span><span class="n">fastest_lap</span><span class="p">,</span> <span class="n">interpolate_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="disclaimer">
<h2>Disclaimer<a class="headerlink" href="#disclaimer" title="Permalink to this headline">¶</a></h2>
<p>The information here is what I have discovered to be most effective. This is probably not perfect. There are just too
many (time consuming) things that can be tried out. If you have some better ideas or want to discuss accuracy and
possibilities, feel free to open an issue about it.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="known_bugs.html" class="btn btn-neutral float-right" title="Known bugs and caveats" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="time_explanation.html" class="btn btn-neutral float-left" title="Time, Date and Timing - Explanation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, theOehrly.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>